/*****************************************************************************
  * @file:    	debug.c
  * @author:  	louiswoo
  * @version: 	V1.0
  * @date:	2020-6-6
  * @brief:	调试模块，主要调用串口进行调试信息的输出
	包括字符串输出和 unsigned int型2字节的变量输出
*******************************************************************************/
#include "config.h"
#include "debug.h"
/****************************************************************************************
  * @brief:	初始化时间串口，波特率4800bps@5.74MHz
  * @param:	none
  * @retval:	none
*****************************************************************************************/

void UsartInit(void)		//4800bps@5.74MHz
{
	PCON &= 0x7F;		//??????
	SCON = 0x50;		//8???,?????
	AUXR |= 0x40;		//???1???Fosc,?1T
	AUXR &= 0xFE;		//??1?????1???????
	TMOD &= 0x0F;		//?????1???
	TMOD |= 0x20;		//?????1?8???????
	TL1 = 0xDB;		//??????
	TH1 = 0xDB;		//????????
	ET1 = 0;		//?????1??
	TR1 = 1;		//?????1
}

/****************************************************************************************
  * @brief:	串口发送字符串，采用等待延时方式等待字符串发送完成再返回
比较耗时间
	* @param:	str: 字符串指针
  * @retval:	none
*****************************************************************************************/

void UsartSendString(u8 *str)
{
	while(*str)
	{
		SBUF = *str;
		while(!TI)	;
		TI=0;
		str++;
	}
}
/****************************************************************************************
  * @brief:	发送一个u16变量
	* @param:	var: u16变量
  * @retval:	none
*****************************************************************************************/

void UsartSendVar(u16 var)
{
	u8 num[6];
	num[0]=var/10000+0x30;
	num[1]=var%10000/1000+0x30;
	num[2]=var%1000/100+0x30;
	num[3]=var%100/10+0x30;
	num[4]=var%10+0x30;
	num[5]='\0';
	debug(num);
}